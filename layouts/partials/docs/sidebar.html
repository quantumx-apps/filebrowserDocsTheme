<!-- sidebar-wrapper -->
<nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-content" >
        <div class="sidebar-brand">
            <a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
                {{ with .Site.Data.landing.hero.titleLogo }}
                    {{ if .icon }}
                        <!-- SVG Logo from static folder -->
                        <span style="display: inline-flex; align-items: center; height: 45px; line-height: 45px;">
                            <img src="{{ "logo.svg" | absURL }}" alt="Logo" style="height: 45px;">
                        </span>
                    {{ end }}
                {{ end }}
                <h5 class="mb-0" style="font-size: 1.1rem; font-weight: 600; color: var(--sidebar-text-color);">
                    {{ .Site.Data.landing.hero.title | default "FileBrowser Quantum" }}
                </h5>
            </a>
        </div>
        <ul class="sidebar-menu">
            {{ $currentPage := . -}}
            {{ $section := $currentPage.Section -}}

                {{/* Use the custom auto-ordering system that respects manual weights */}}
                {{ $sortedItems := partial "docs/auto-order.html" . }}


            {{ $sidebarIcons := .Site.Params.docs.sidebarIcons }}
            {{ range $sortedItems }}
                {{ $page := .Page }}
                {{ $active := in $currentPage.RelPermalink $page.RelPermalink }}
                {{ $hasChildren := or $page.Sections $page.Pages }}


                {{ if eq .Type "section" }}
                    {{ if $hasChildren }}
                        <li class="sidebar-dropdown {{ if eq $sidebarIcons false -}}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                            <button class="btn">
                                {{ if eq $sidebarIcons true -}}
                                    <i class="material-icons me-2">{{- $page.Params.icon | default "notes" }}</i>
                                {{ end }}
                                {{- $page.Title }}
                            </button>
                                <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                <ul>
                                    {{/* Process subsections and pages for this section */}}
                                    {{ range $sortedItems }}
                                        {{ if and (eq .Type "subsection") (in $page.Sections .Page) }}
                                            {{ $subPage := .Page }}
                                            {{ $subActive := in $currentPage.RelPermalink $subPage.RelPermalink }}
                                            <li class="sidebar-dropdown nested {{ if eq $sidebarIcons false -}}no-icon{{ end }} {{ if $subActive }}current active{{ end }}">
                                                <button class="btn">
                                                    {{ if eq $sidebarIcons true -}}
                                                        <i class="material-icons me-2">{{- $subPage.Params.icon | default "folder" }}</i>
                                                    {{ end }}
                                                    {{- $subPage.Title }}
                                                </button>
                                                <div class="sidebar-submenu {{ if $subActive }}d-block{{ end }}">
                                                    <ul>
                                                        {{/* Process pages in this subsection */}}
                                                        {{ range $sortedItems }}
                                                            {{ if and (eq .Type "page") (and .ParentSubsection (eq .ParentSubsection.RelPermalink $subPage.RelPermalink)) }}
                                                                {{ $pageActive := in $currentPage.RelPermalink .Page.RelPermalink }}
                                                                <li class="{{ if $pageActive }}current{{ end }} {{ if eq $sidebarIcons false -}}no-icon{{ end }}">
                                                                    <a class="sidebar-nested-link" href="{{ .Page.Permalink }}">{{ .Page.Title }}</a>
                                                                </li>
                                                            {{ end }}
                                                        {{ end }}
                                                    </ul>
                                                </div>
                                            </li>
                                        {{ else if and (eq .Type "page") (in $page.Pages .Page) }}
                                            {{ $pageActive := in $currentPage.RelPermalink .Page.RelPermalink }}
                                            <li class="{{ if $pageActive }}current{{ end }} {{ if eq $sidebarIcons false -}}no-icon{{ end }}">
                                                <a class="sidebar-nested-link" href="{{ .Page.Permalink }}">{{ .Page.Title }}</a>
                                            </li>
                                        {{ end }}
                                    {{ end }}
                                </ul>
                            </div>
                        </li>
                    {{ else }}
                        {{/* Section without children */}}
                        <li class="{{ if $active }}current{{ end }}">
                            <a class="sidebar-root-link" href="{{ $page.Permalink }}">
                                {{ if eq $sidebarIcons true -}}
                                    <i class="material-icons me-2">{{ $page.Params.icon | default "notes" }}</i>
                                {{ end }}
                                {{ $page.Title }}
                            </a>
                        </li>
                    {{ end }}
                {{ end }}
            {{ end }}
        </ul>

    </div>

    <!-- Sidebar Footer -->
        <ul class="sidebar-footer list-unstyled mb-0">
            <!-- <li class="list-inline-item mb-0">
                <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#lang-selector-popup" class="btn btn-primary m-1">Language</a>
            </li> -->
        </ul>
    <!-- Sidebar Footer -->
</nav>
<!-- sidebar-wrapper  -->