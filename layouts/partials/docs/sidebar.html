<!-- sidebar-wrapper -->
<nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-content" >
        <div class="sidebar-brand">
            <a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
                {{ with .Site.Data.landing.hero.titleLogo }}
                    {{ if .icon }}
                        <!-- Material Icon Logo -->
                        <span style="display: inline-flex; align-items: center; height: 30px; line-height: 30px;">
                            <i class="material-icons filled" style="font-size: 30px; color: {{ .iconColor | default "#2196F3" }};">{{ .icon }}</i>
                        </span>
                    {{ end }}
                {{ end }}
                <h5 class="mb-0" style="font-size: 1.1rem; font-weight: 600; color: var(--sidebar-text-color);">
                    {{ .Site.Data.landing.hero.title | default "FileBrowser Quantum" }}
                </h5>
            </a>
        </div>
        <ul class="sidebar-menu">
            {{ $currentPage := . -}}
            {{ $section := $currentPage.Section -}}
            
            {{/* Check if automatic ordering is enabled */}}
            {{ if .Site.Params.autoOrdering }}
                {{/* Use automatic ordering based purely on file system structure */}}
                {{ $docsSection := .Site.GetPage "docs" }}
                
                {{/* Process sections in order by file path */}}
                {{ $sortedSections := slice }}
                {{ range $docsSection.Sections }}
                    {{ $item := dict 
                        "Page" .
                        "Path" .File.Dir
                    }}
                    {{ $sortedSections = $sortedSections | append $item }}
                {{ end }}
                {{/* Sort sections with custom order support */}}
                {{ $sortedSections = partial "docs/sort-items.html" (dict "items" $sortedSections) }}
                
                {{ range $sortedSections }}
                    {{ $sectionPage := .Page }}
                    {{ $active := in $currentPage.RelPermalink $sectionPage.RelPermalink }}
                    {{ $hasChildren := or $sectionPage.Sections $sectionPage.Pages }}
                        
                    {{ if $hasChildren }}
                        <li class="sidebar-dropdown {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                            <button class="btn">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{- $sectionPage.Params.icon | default "notes" }}</i>
                                {{ end }}
                                {{- $sectionPage.Title }}
                            </button>
                            <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                <ul>
                                    {{/* Process subsections and pages, sorted by file path */}}
                                    {{ $subItems := slice }}
                                    
                                    {{/* Add subsections */}}
                                    {{ range $sectionPage.Sections }}
                                        {{ $subItem := dict 
                                            "Page" .
                                            "Type" "subsection"
                                            "Path" .File.Dir
                                            "Title" .Title
                                        }}
                                        {{ $subItems = $subItems | append $subItem }}
                                    {{ end }}
                                    
                                    {{/* Add pages */}}
                                    {{ range $sectionPage.Pages }}
                                        {{ if not .IsSection }}
                                            {{ $subItem := dict 
                                                "Page" .
                                                "Type" "page"
                                                "Path" .File.Dir
                                                "Title" .Title
                                            }}
                                            {{ $subItems = $subItems | append $subItem }}
                                        {{ end }}
                                    {{ end }}
                                    
                                    {{/* Sort by custom order, then by file path */}}
                                    {{ $sortedSubItems := partial "docs/sort-items.html" (dict "items" $subItems) }}
                                    
                                    {{ range $sortedSubItems }}
                                        {{ $subPage := .Page }}
                                        {{ $subActive := in $currentPage.RelPermalink $subPage.RelPermalink }}
                                        
                                        {{ if eq .Type "subsection" }}
                                            {{/* Subsection with nested content */}}
                                            <li class="sidebar-dropdown nested {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $subActive }}current active{{ end }}">
                                                <button class="btn">
                                                    {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                                        <i class="material-icons me-2">{{- $subPage.Params.icon | default "folder" }}</i>
                                                    {{ end }}
                                                    {{- $subPage.Title }}
                                                </button>
                                                <div class="sidebar-submenu {{ if $subActive }}d-block{{ end }}">
                                                    <ul>
                                                        {{/* Process pages in subsection, sorted by file path */}}
                                                        {{ $nestedItems := slice }}
                                                        {{ range $subPage.Pages }}
                                                            {{ $nestedItem := dict 
                                                                "Page" .
                                                                "Path" .File.Dir
                                                                "Title" .Title
                                                            }}
                                                            {{ $nestedItems = $nestedItems | append $nestedItem }}
                                                        {{ end }}
                                                        {{/* Sort by custom order, then by file path */}}
                                                        {{ $sortedNestedItems := partial "docs/sort-items.html" (dict "items" $nestedItems) }}
                                                        {{ range $sortedNestedItems }}
                                                            {{ $pageActive := in $currentPage.RelPermalink .Page.RelPermalink }}
                                                            <li class="{{ if $pageActive }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}">
                                                                <a class="sidebar-nested-link" href="{{ .Page.Permalink }}">{{ .Page.Title }}</a>
                                                            </li>
                                                        {{ end }}
                                                    </ul>
                                                </div>
                                            </li>
                                        {{ else }}
                                            {{/* Direct page */}}
                                            <li class="{{ if $subActive }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}">
                                                <a class="sidebar-nested-link" href="{{ $subPage.Permalink }}">{{ $subPage.Title }}</a>
                                            </li>
                                        {{ end }}
                                    {{ end }}
                                </ul>
                            </div>
                        </li>
                    {{ else }}
                        {{/* Section without children */}}
                        <li class="{{ if $active }}current{{ end }}">
                            <a class="sidebar-root-link" href="{{ $sectionPage.Permalink }}">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{ $sectionPage.Params.icon }}</i>
                                {{ end }}
                                {{ $sectionPage.Title }}
                            </a>
                        </li>
                    {{ end }}
                {{ end }}
            {{ else }}
                {{/* Use original weight-based ordering */}}
                {{ range (where .Site.Sections.ByWeight "Section" "in" $section) }}
                    {{ $child_pages := union .Sections .Pages }}
                    {{ range $child_pages.ByWeight }}
                    {{ if or (.Sections) (.Pages) }}
                    {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                        <li class="sidebar-dropdown {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                            <button class="btn">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{- .Params.icon | default "notes" }}</i>
                                {{ end }}
                                {{- .Title }}
                            </button>
                            <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                <ul>
                                    {{ range .Pages }}
                                        {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                        {{ if .IsSection }}
                                            <li class="sidebar-dropdown nested {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                                                <button class="btn">
                                                    {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                                        <!-- <span class="material-icons me-2">{{- .Params.icon }}</span> -->
                                                    {{ end }}
                                                    {{- .Title }}
                                                </button>
                                                <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                                    <ul>
                                                        {{ range .Pages }}
                                                            {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                                            {{ if .IsSection }}
                                                                <li class="sidebar-dropdown nested {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                                                                    <button class="btn">
                                                                        {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                                                            <!-- <span class="material-icons me-2">{{- .Params.icon }}</span> -->
                                                                        {{ end }}
                                                                        {{- .Title }}
                                                                    </button>
                                                                    <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                                                        <ul>
                                                                            {{ range .Pages }}
                                                                                {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                                                                {{ if .IsSection }}
                                                                                    <li class="sidebar-dropdown nested {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                                                                                        <button class="btn">
                                                                                            {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                                                                                <!-- <span class="material-icons me-2">{{- .Params.icon }}</span> -->
                                                                                            {{ end }}
                                                                                            {{- .Title }}
                                                                                        </button>
                                                                                        <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                                                                            <ul>
                                                                                                {{ range .Pages }}
                                                                                                    {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                                                                                                    <li class="{{ if $active }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}"><a class="sidebar-nested-link" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                                                                                {{ end }}
                                                                                            </ul>
                                                                                        </div>
                                                                                    </li>
                                                                                {{ else }}
                                                                                    <li class="{{ if $active }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}"><a class="sidebar-nested-link" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                                                                {{ end }}
                                                                            {{ end }}
                                                                        </ul>
                                                                    </div>
                                                                </li>
                                                            {{ else }}
                                                                <li class="{{ if $active }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}"><a class="sidebar-nested-link" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                                            {{ end }}
                                                        {{ end }}
                                                    </ul>
                                                </div>
                                            </li>
                                        {{ else }}
                                            <li class="{{ if $active }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}"><a class="sidebar-nested-link" href="{{ .Permalink }}">{{ .Title }}</a></li>
                                        {{ end }}
                                    {{ end }}
                                </ul>
                            </div>
                        </li>
                    {{ else }}
                        {{ $active := in $currentPage.RelPermalink .RelPermalink }}
                        <li class="{{ if $active }}current{{ end }}">
                            <a class="sidebar-root-link" href="{{ .Permalink }}">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{ .Params.icon }}</i>
                                {{ end }}
                                {{ .Title }}
                            </a>
                        </li>
                    {{ end }}
                {{ end }}
            {{ end }}
        {{ end }}
        </ul>
        <!-- sidebar-menu  -->
    </div>
    <!-- Sidebar Footer -->
        <ul class="sidebar-footer list-unstyled mb-0">
            <!-- <li class="list-inline-item mb-0">
                <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#lang-selector-popup" class="btn btn-primary m-1">Language</a>
            </li> -->
        </ul>
    <!-- Sidebar Footer -->
</nav>
<!-- sidebar-wrapper  -->