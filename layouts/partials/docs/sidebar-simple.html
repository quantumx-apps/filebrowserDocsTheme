<!-- sidebar-wrapper with simple automatic ordering -->
<nav id="sidebar" class="sidebar-wrapper">
    <div class="sidebar-content" >
        <div class="sidebar-brand">
            <a href="/" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 8px;">
                {{ with .Site.Data.landing.hero.titleLogo }}
                    {{ if .icon }}
                        <!-- Material Icon Logo -->
                        <span style="display: inline-flex; align-items: center; height: 30px; line-height: 30px;">
                            <i class="material-icons filled" style="font-size: 30px; color: {{ .iconColor | default "#2196F3" }};">{{ .icon }}</i>
                        </span>
                    {{ end }}
                {{ end }}
                <h5 class="mb-0" style="font-size: 1.1rem; font-weight: 600; color: var(--sidebar-text-color);">
                    {{ .Site.Data.landing.hero.title | default "FileBrowser Quantum" }}
                </h5>
            </a>
        </div>
        <ul class="sidebar-menu">
            {{ $currentPage := . -}}
            {{ $section := $currentPage.Section -}}
            
            <!-- DEBUG: Sidebar Icons Configuration -->
            <li style="background: #f0f0f0; padding: 10px; margin: 5px; border: 1px solid #ccc;">
                <strong>DEBUG INFO:</strong><br>
                sidebarIcons param: {{ .Site.Params.docs.sidebarIcons }}<br>
                sidebarIcons type: {{ printf "%T" .Site.Params.docs.sidebarIcons }}<br>
                sidebarIcons eq true: {{ eq .Site.Params.docs.sidebarIcons true }}<br>
                Site.Params.docs: {{ .Site.Params.docs }}<br>
                <br>
                <strong>TEST ICON (should always show):</strong><br>
                <i class="material-icons me-2" style="color: red;">bug_report</i> Test Icon
            </li>

            {{/* Define section order based on directory structure */}}
            {{ $sectionOrder := slice
                "getting-started"
                "configuration"
                "access-control"
                "shares"
                "integrations"
                "user-guides"
                "advanced"
                "reference"
                "contributing"
                "help"
            }}

            {{/* Get docs section */}}
            {{ $docsSection := .Site.GetPage "docs" }}

            {{/* Sort sections by predefined order */}}
            {{ range $sectionOrder }}
                {{ $sectionName := . }}
                {{ $sectionPage := $docsSection.GetPage $sectionName }}
                {{ if $sectionPage }}
                    {{ $active := in $currentPage.RelPermalink $sectionPage.RelPermalink }}
                    {{ $hasChildren := or $sectionPage.Sections $sectionPage.Pages }}

                    {{ if $hasChildren }}
                        <li class="sidebar-dropdown {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $active }}current active{{ end }}">
                            <button class="btn">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{- $sectionPage.Params.icon | default "notes" }}</i>
                                {{ else }}
                                    <!-- DEBUG: No icon rendered for {{ $sectionPage.Title }} -->
                                {{ end }}
                                {{- $sectionPage.Title }}
                            </button>
                            <div class="sidebar-submenu {{ if $active }}d-block{{ end }}">
                                <ul>
                                    {{/* Process subsections first, then pages */}}
                                    {{ $subItems := slice }}

                                    {{/* Add subsections */}}
                                    {{ range $sectionPage.Sections }}
                                        {{ $subItem := dict
                                            "Page" .
                                            "Type" "subsection"
                                            "Title" .Title
                                        }}
                                        {{ $subItems = $subItems | append $subItem }}
                                    {{ end }}

                                    {{/* Add pages */}}
                                    {{ range $sectionPage.Pages }}
                                        {{ if not .IsSection }}
                                            {{ $subItem := dict
                                                "Page" .
                                                "Type" "page"
                                                "Title" .Title
                                            }}
                                            {{ $subItems = $subItems | append $subItem }}
                                        {{ end }}
                                    {{ end }}

                                    {{/* Sort by type (subsections first), then by title */}}
                                    {{ $sortedSubItems := sort $subItems "Type" "asc" }}
                                    {{ $sortedSubItems = sort $sortedSubItems "Title" "asc" }}

                                    {{ range $sortedSubItems }}
                                        {{ $subPage := .Page }}
                                        {{ $subActive := in $currentPage.RelPermalink $subPage.RelPermalink }}

                                        {{ if eq .Type "subsection" }}
                                            {{/* Subsection with nested content */}}
                                            <li class="sidebar-dropdown nested {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }} {{ if $subActive }}current active{{ end }}">
                                                <button class="btn">
                                                    {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                                        <i class="material-icons me-2">{{- $subPage.Params.icon | default "folder" }}</i>
                                                    {{ else }}
                                                        <!-- DEBUG: No nested icon rendered for {{ $subPage.Title }} -->
                                                    {{ end }}
                                                    {{- $subPage.Title }}
                                                </button>
                                                <div class="sidebar-submenu {{ if $subActive }}d-block{{ end }}">
                                                    <ul>
                                                        {{/* Process pages in subsection, sorted by title */}}
                                                        {{ range sort $subPage.Pages "Title" "asc" }}
                                                            {{ $pageActive := in $currentPage.RelPermalink .RelPermalink }}
                                                            <li class="{{ if $pageActive }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}">
                                                                <a class="sidebar-nested-link" href="{{ .Permalink }}">{{ .Title }}</a>
                                                            </li>
                                                        {{ end }}
                                                    </ul>
                                                </div>
                                            </li>
                                        {{ else }}
                                            {{/* Direct page */}}
                                            <li class="{{ if $subActive }}current{{ end }} {{ if eq .Site.Params.docs.sidebarIcons true -}}{{ else }}no-icon{{ end }}">
                                                <a class="sidebar-nested-link" href="{{ $subPage.Permalink }}">{{ $subPage.Title }}</a>
                                            </li>
                                        {{ end }}
                                    {{ end }}
                                </ul>
                            </div>
                        </li>
                    {{ else }}
                        {{/* Section without children */}}
                        <li class="{{ if $active }}current{{ end }}">
                            <a class="sidebar-root-link" href="{{ $sectionPage.Permalink }}">
                                {{ if eq .Site.Params.docs.sidebarIcons true -}}
                                    <i class="material-icons me-2">{{ $sectionPage.Params.icon }}</i>
                                {{ end }}
                                {{ $sectionPage.Title }}
                            </a>
                        </li>
                    {{ end }}
                {{ end }}
            {{ end }}
        </ul>
        <!-- sidebar-menu  -->
    </div>
    <!-- Sidebar Footer -->
        <ul class="sidebar-footer list-unstyled mb-0">
            <!-- <li class="list-inline-item mb-0">
                <a href="javascript:void(0)" data-bs-toggle="modal" data-bs-target="#lang-selector-popup" class="btn btn-primary m-1">Language</a>
            </li> -->
        </ul>
    <!-- Sidebar Footer -->
</nav>
<!-- sidebar-wrapper  -->
